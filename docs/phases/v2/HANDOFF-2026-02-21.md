# Start-of-Day Brief — 2026-02-21

**Date:** 2026-02-21
**Branch:** `main`
**Phase:** 7 — Integration Hardening (3/5 steps complete)

> Read this first. Full session narrative: [HANDOFF-2026-02-20.md](HANDOFF-2026-02-20.md)

---

## Current Status

```
• [x] Phase 5: Cold Tier / Iceberg Offload — COMPLETE
• [x] Phase 6: Kotlin Feed Handlers — COMPLETE
• [ ] Phase 7: Integration Hardening — ACTIVE (3/5 steps)
  • [x] Step 1: Latency Benchmark — COMPLETE (p99 ≤197ms all exchanges)
  • [~] Step 2: Resource Validation — BURN-IN RUNNING (PID 107291, /tmp/k2-burn-in.csv)
  • [x] Step 3: Failure Mode Testing — COMPLETE (all 6 pass, max MTTR 32s)
  • [~] Step 4: Monitoring & Alerting — 80% DONE (rules live, dashboard committed)
  • [ ] Step 5: Runbooks & Documentation Finalisation — not started
```

---

## First Things to Do

### 1. Fix Coinbase (quick — 30s)

Coinbase normalized trades stopped flowing during the Redpanda restart test yesterday. Schema
registration got stuck in a permanent retry loop. The schema IS registered correctly; the
producer just needs a fresh JVM client.

```bash
docker compose -f docker-compose.v2.yml up -d --force-recreate --no-deps feed-handler-coinbase
# Wait 30s then verify:
docker logs k2-feed-handler-coinbase --tail 5
# Should show: Metrics [coinbase]: Raw=N, Normalized=N, Errors=0
```

### 2. Collect 24h burn-in results

The sampling loop started 2026-02-19 ~09:53 local (PID 107291, /tmp/k2-burn-in.csv).

```bash
# Check still running
ps aux | grep k2-burn-in

# CPU averages per service
awk -F',' 'NF==4 {sum[$1]+=$2; count[$1]++} END {for (s in sum) printf "%s: avg CPU %.2f%%\n", s, sum[s]/count[s]}' \
  /tmp/k2-burn-in.csv | sort

# RAM averages (need to strip MiB/GiB units — easier to just tail for spot check)
tail -20 /tmp/k2-burn-in.csv
```

Record 24h averages in `docs/phases/v2/phase-7-integration-hardening/PROGRESS.md`.
Then kill the loop: `kill 107291`

---

## Today's Work

### Priority 1: Complete Step 4 — Monitoring & Alerting

**What's needed:**

1. **FeedHandlerDown alert fire test:**
   ```bash
   docker compose -f docker-compose.v2.yml stop feed-handler-binance
   # Wait 2+ minutes
   # Check: http://localhost:9090/alerts — FeedHandlerDown should show FIRING
   docker compose -f docker-compose.v2.yml start feed-handler-binance
   ```

2. **Grafana dashboard review:** Open http://localhost:3000 → K2 Platform v2 → K2 Pipeline Overview. Confirm panels load with data.

3. Mark step-04 ✅ in the step file.

### Priority 2: Step 5 — Runbooks + Documentation Finalisation

**Full spec:** [step-05-runbooks-documentation.md](phase-7-integration-hardening/steps/step-05-runbooks-documentation.md)

5 runbooks to write (in `docs/operations/runbooks/`):
1. `feed-handler-recovery.md` — crash, reconnect loops, schema registration failures
2. `clickhouse-recovery.md` — restart, memory OOM, Kafka consumer stall
3. `redpanda-recovery.md` — restart, topic deletion, consumer lag
4. `iceberg-offload-failure.md` — Spark failure, watermark issues, MinIO unavailable
5. `on-call-guide.md` — first-response checklist, escalation paths, key URLs

Then:
- Update `ARCHITECTURE-V2.md` with measured latency values (p99 ~200ms) and actual resource numbers
- Create git tag: `git tag v2-phase-7-complete`
- Update `CURRENT-STATE.md` → Phase 7 = ✅ Complete

---

## Key Context

### Coinbase Schema Registration Bug (parked)
- Root cause: Redpanda schema registry race condition at startup. All 3 handlers fail initially; binance/kraken retry out of it; coinbase stayed stuck.
- Schema IS registered (ID=1, subject `market.crypto.trades.coinbase-value`) — confirmed working
- Fix: force-recreate the container (fresh JVM = clean retry from scratch)
- NOT a Redpanda bug per se — the schema registry and topics are healthy

### Prometheus Alert Rules (live)
- `docker/prometheus/rules/feed-handler-alerts.yml` — FeedHandlerDown, HighErrorRate, FrequentReconnects
- `docker/prometheus/rules/clickhouse-alerts.yml` — CH down, high memory, low insert rate
- `docker/prometheus/rules/iceberg-offload-alerts.yml` — lag, failures, scheduler down
- Check at: http://localhost:9090/alerts (33 rules loaded)

### Burn-in Loop
- PID: 107291, file: `/tmp/k2-burn-in.csv`, every 5 min since 2026-02-19 ~09:53
- Kill after collecting results: `kill 107291`

---

## End-of-Day Targets for 2026-02-21

```
• [ ] Coinbase fixed (force-recreate, normalized flowing)
• [ ] Step 2: 24h burn-in results collected + PROGRESS.md updated
• [ ] Step 4: FeedHandlerDown alert fire test ✅
• [ ] Step 4: Grafana dashboard confirmed working ✅
• [ ] Step 4: step-04 file marked ✅ Complete
• [ ] Step 5: All 5 runbooks written
• [ ] Step 5: ARCHITECTURE-V2.md updated with measured values
• [ ] Step 5: Git tag v2-phase-7-complete created
• [ ] CURRENT-STATE.md updated (Phase 7 = ✅ Complete)
• [ ] This HANDOFF updated → HANDOFF-2026-02-22.md (or close out phase)
```

---

## Related Docs

- [Phase 7 PROGRESS](phase-7-integration-hardening/PROGRESS.md)
- [Step 4: Monitoring & Alerting](phase-7-integration-hardening/steps/step-04-monitoring-alerting.md)
- [Step 5: Runbooks](phase-7-integration-hardening/steps/step-05-runbooks-documentation.md)
- [CURRENT-STATE.md](CURRENT-STATE.md)
- [HANDOFF-2026-02-20.md](HANDOFF-2026-02-20.md)
